<html>
  <head>
    <style>
      html,
      body,
      #map {
        margin: 0;
        width: 100%;
        height: 98%;
      }
    </style>
    <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
    <script src="https://apis.mapmyindia.com/advancedmaps/v1/8sd157d6dfneikj3hbkgltzbhsdvh45o/map_load?v=1.3"></script>
  </head>

  <body>
    <div id="map"></div>
    <button onclick="route()">Draw route</button>
    <button onclick="removeRoute()">Remove route</button>

    <div>
      <div id="s_lat">{{ s_lon }}</div>
      <div id="s_lon">{{ s_lat }}</div>
      <div id="e_lat">{{ e_lon }}</div>
      <div id="e_lon">{{ e_lat }}</div>
    </div>
    <script>
      let startlat = document.querySelector('#s_lat').innerText;
      let startlong = document.querySelector('#s_lon').innerText;
      let destlat = document.querySelector('#e_lat').innerText;
      let destlong = document.querySelector('#e_lon').innerText;
      console.log(startlat);
      var map;
      var pts1;
      var poly1;
      url = 'https://apis.mapmyindia.com/advancedmaps/v1/8sd157d6dfneikj3hbkgltzbhsdvh45o/route_adv/driving/' + startlat + ',' + startlong + ';' + destlat + ',' + destlong + '?alternatives=true&&geometries=polyline&overview=full&exclude=&steps=true&region=ind';
      console.log(url);
      // draw map
      map = new MapmyIndia.Map('map', {
        center: [28.61, 77.23],
        zoom: 9
      });

      // decode function
      function decode_path(encoded) {
        if (encoded != 'undefined') {
          var pts = [];
          var index = 0,
            len = encoded.length;
          var lat = 0,
            lng = 0;
          while (index < len) {
            var b,
              shift = 0,
              result = 0;
            do {
              b = encoded.charAt(index++).charCodeAt(0) - 63;
              result |= (b & 0x1f) << shift;
              shift += 5;
            } while (b >= 0x20);

            var dlat = (result & 1) != 0 ? ~(result >> 1) : result >> 1;
            lat += dlat;
            shift = 0;
            result = 0;
            do {
              b = encoded.charAt(index++).charCodeAt(0) - 63;
              result |= (b & 0x1f) << shift;
              shift += 5;
            } while (b >= 0x20);
            var dlng = (result & 1) != 0 ? ~(result >> 1) : result >> 1;
            lng += dlng;
            pts.push([lat / 1e5, lng / 1e5]);
          }
          return pts;
        } else {
          return '';
        }
      }

      // call route api using Jsonp
      function route() {
        $.ajax({
          data: 'text/json,application/json',
          contentType: 'application/json,text/json',
          dataType: 'jsonp',
          type: 'GET',
          crossDomain: true,
          url: 'https://apis.mapmyindia.com/advancedmaps/v1/8sd157d6dfneikj3hbkgltzbhsdvh45o/route_adv/driving/' + startlat + ',' + startlong + ';' + destlat + ',' + destlong + '?alternatives=true&&geometries=polyline&overview=full&exclude=&steps=true&region=ind',
          error: function(data) {
            console.log(data);
            //alert('An error has occurred');
          },
          success: this.scriptCallback
        });
      }
      // callback function
      scriptCallback = function(data) {
        pts1 = decode_path(data.routes[0].geometry);
        // Draw polyline
        poly1 = new L.Polyline(pts1, { weight: 5, opacity: 1, color: 'black' });
        map.addLayer(poly1);
        map.fitBounds(poly1.getBounds());
      };

      // Remove Route function
      function removeRoute() {
        map.removeLayer(poly1);
        map.setZoom(12);
      }
    </script>
  </body>
</html>
